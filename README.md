# Лабораторная работа №4


## Структура проекта

 <pre>
    ├── lab_4
    │   ├── src/                               # Исходный код
    │   ├── tests/                             # Unit-тесты
    │   ├── uv.lock                            # Зависимости проекта
    │   ├── .gitignore                         # Git-ignore файл
    │   ├──.pre-commit-config.yaml             # Средства автоматизации проверки кодстайла
    │   ├── README.md                          # Описание проекта
</pre>

> В папке [src](./src) лежат файлы с реализацией задачи, заданной в лабораторной работе. В файле [main.py](./src/main.py) описана точка входа в приложение - функция **main**

Запуск симуляции:

```
python -m main
```

### Архитектура системы

Система построена по принципу разделения ответственности:

1. **Library** - внешний интерфейс для работы с читателями
   - Выдача и возврат книг
   - Учет читателей и статистика
   - Генерация отчетов

2. **BookCollection** - управление библиотечным фондом
   - Добавление и удаление книг
   - Валидация данных
   - Учет количества экземпляров

3. **IndexDict** - быстрый поиск по каталогу
   - Индексация по автору, году, жанру, ISBN
   - Мгновенный доступ без перебора коллекции

### Основная логика реализации

> В файле [book_collection.py](./src/book_collection.py) содержится реализация классов Book, BookCollection и IndexDict - основных составляющих библиотеки. При этом поля IndexDict (словари для поиска по разным ключам) реализованы как производные классы от базового класса Index. Каждой коллекции соответствует свой IndexDict. Реализованы методы взаимодействия с классами: добавление и  удаление книг, валидация данных, получение информации о книгах, различные магические методы для индексации по коллекциям, их корректного отображения, изменения, слияния и сравнения.

> В файле [library.py](./src/library.py) содержится реализация классов Library и BorrowerInfo. Каждой библиотеке соответствует своя коллекция. Методы этих классов позволяют симулировать выдачу и возврат книг в библиотеку, просмотр статистики библиотеки и юзеров.

*Стоит отметить, что доступны дублирование книг и операции с количеством дубликатов (то есть в библиотеке и коллекции может быть много одинаковых книг, и этот факт учитывается при всех взаимодействиях). При этом IndexDict не работает с количеством дубликатов - для поиска эта логика будет излишней*

*Консольные логи всех методов реализованы и в основном являются возвращаемыми объектами методов*

*Некорректные данные валидируются, при необходимости вызывается кастомная ошибка LibraryException. Важно отличать ошибку (Exception), от простого текстового лога. Ошибки возникают при получении неваливдных данных (например, неправильный тип данных), а логи свидетельствуют о невозможности выполнения валидной операции в текущих условиях (например, недостаточно книг для выдачи)*

> В файле [constants.py](./src/constants.py) описаны основные используемые константы

> В файле [book_database.py](./src/book_database.py) содержится набор книг (в том числе с невалидными полями), необходимый для тестирования и запуска симуляций.

> В файле [simulation.py](./src/simulation.py) реализована логика случайной симуляции работы основных модулей (с помощью класса Simulator), включающая структурированный вывод информации о ходе работы.


### Тестирование

> В папке [tests](./tests) лежат unit-тесты основных модулей

> В файле [test_book_collection.py](./tests/test_book_collection.py) тестируется функционал, реализованный в файле [book_collection.py](./src/book_collection.py)

> В файле [test_library.py](./tests/test_library.py) тестируется функционал, реализованный в файле [library.py](./src/library.py)

Запуск тестов:

```
cd tests
pytest test_library.py
pytest test_book_collection.py
```
